---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Navigation from "../../components/navigation.astro";
import ContactMe from "../../components/contactme.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
    const projects = await getCollection("projects");
    console.log(
        "[v0] Project static paths:",
        projects.map((p) => ({ slug: p.id, title: p.data.title })),
    );
    return projects.map((project) => ({
        params: { slug: project.id.replace(".md", "") },
        props: { project },
    }));
}

const { project } = Astro.props;
console.log("[v0] Rendering project:", project.id, project.data.title);
const { Content } = await render(project);
---

<BaseLayout pageTitle={`${project.data.title} - Carolina Lima`}>
    <Navigation />
    <a href="/#works" class="back-button">
        <svg
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path
                d="M15 10H5M5 10L10 15M5 10L10 5"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"></path>
        </svg>
        Back
    </a>
    <div class="project-page">
        <h1 class="project-title">{project.data.title}</h1>

        <div class="hero-section">
            <img
                src={project.data.image || "/placeholder.svg"}
                alt={`${project.data.title} Project Hero`}
                class="hero-image"
            />
            {
                project.data.websiteUrl && (
                    <a
                        href={project.data.websiteUrl}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="visit-link"
                    >
                        Visit the website
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 20 20"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M5 15L15 5M15 5H5M15 5V15"
                                stroke="currentColor"
                                stroke-width="2"
                            />
                        </svg>
                    </a>
                )
            }
        </div>

        <div class="separator"></div>

        <div class="project-details">
            <div class="detail-row">
                <div class="detail-column">
                    <p class="detail-label">Challenge:</p>
                    <p class="detail-value">{project.data.label}</p>
                </div>
                <div class="detail-column">
                    <p class="detail-label">Service:</p>
                    <p class="detail-value">{project.data.service || "N/A"}</p>
                </div>
            </div>
            <div class="detail-row">
                <div class="detail-column">
                    <p class="detail-label">Software:</p>
                    <p class="detail-value">{project.data.software || "N/A"}</p>
                </div>
                <div class="detail-column">
                    <p class="detail-label">Year:</p>
                    <p class="detail-value">{project.data.year || "N/A"}</p>
                </div>
            </div>
        </div>

        <div class="overview-section markdown-content">
            <Content />
        </div>

        {
            project.data.designImages &&
                project.data.designImages.length > 0 && (
                    <div class="design-overview-section">
                        <h2 class="design-heading">DESIGN OVERVIEW</h2>
                        <div class="design-grid">
                            <div class="design-column">
                                <img
                                    src={
                                        project.data.designImages[0] ||
                                        "/placeholder.svg"
                                    }
                                    alt={`${project.data.title} Design 1`}
                                />
                            </div>
                            <div class="design-column">
                                {project.data.designImages
                                    .slice(1)
                                    .map((img: string, index: number) => (
                                        <img
                                            src={img || "/placeholder.svg"}
                                            alt={`${project.data.title} Design ${index + 2}`}
                                        />
                                    ))}
                            </div>
                        </div>
                    </div>
                )
        }

        <div class="separator"></div>

        <div class="more-works-section">
            <h2 class="more-heading">MORE WORKS</h2>
            <div class="more-works-grid">
                {
                    (await getCollection("projects"))
                        .filter((p) => p.id !== project.id)
                        .slice(0, 2)
                        .map((p) => (
                            <a
                                href={`/projects/${p.id.replace(".md", "")}`}
                                class="more-work-item"
                            >
                                <img
                                    src={p.data.image || "/placeholder.svg"}
                                    alt={p.data.title}
                                />
                            </a>
                        ))
                }
            </div>
        </div>
    </div>
    <ContactMe />
</BaseLayout>

<style>
    .project-page {
        background: #fff;
        color: #000;
        padding: 80px 20px 40px;
        max-width: 100%;
    }

    .project-title {
        font-family: "Space Grotesk", sans-serif;
        font-size: 48px;
        font-weight: 700;
        margin: 0 0 40px 0;
        text-align: center;
        letter-spacing: 1px;
    }

    .hero-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        margin-bottom: 40px;
    }

    .hero-image {
        width: 100%;
        max-width: 600px;
        height: auto;
        border-radius: 8px;
    }

    .visit-link {
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: "Space Grotesk", sans-serif;
        font-size: 16px;
        font-weight: 500;
        color: #000;
        text-decoration: none;
        border-bottom: 1px solid #000;
        padding-bottom: 2px;
    }

    .separator {
        width: 100%;
        height: 1px;
        background: #000;
        margin: 40px 0;
    }

    .project-details {
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-bottom: 40px;
    }

    .detail-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .detail-column {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .detail-label {
        font-family: "Space Grotesk", sans-serif;
        font-size: 14px;
        font-style: italic;
        color: #666;
        margin: 0;
    }

    .detail-value {
        font-family: "Space Grotesk", sans-serif;
        font-size: 16px;
        font-weight: 500;
        color: #000;
        margin: 0;
    }

    .overview-section {
        margin-bottom: 60px;
    }

    .markdown-content :global(h2) {
        font-family: "Space Grotesk", sans-serif;
        font-size: 24px;
        font-weight: 700;
        margin: 80px 0 40px 0;
        text-align: center;
    }

    .markdown-content :global(p) {
        font-family: "Space Grotesk", sans-serif;
        font-size: 16px;
        line-height: 1.6;
        color: #333;
        margin: 0;
    }

    .design-overview-section {
        background: #101010;
        color: #fff;
        padding: 60px 20px;
        margin: 0 -20px;
    }

    .design-heading {
        font-family: "Space Grotesk", sans-serif;
        font-size: 36px;
        font-weight: 700;
        margin-bottom: 60px;
        display: block;
        width: 100%;
        text-align: center;
    }

    .design-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .design-column {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .design-grid img {
        width: 100%;
        height: auto;
        border-radius: 0;
    }

    .more-works-section {
        margin: 60px 0 40px;
    }

    .more-heading {
        font-family: "Space Grotesk", sans-serif;
        font-size: 36px;
        font-weight: 700;
        margin-bottom: 40px;
        display: block;
        width: 100%;
        text-align: center;
    }

    .more-works-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        max-width: 800px;
        margin: 0 auto;
    }

    .more-work-item {
        display: block;
        overflow: hidden;
        border-radius: 8px;
    }

    .more-work-item img {
        width: 100%;
        height: auto;
        display: block;
        transition: transform 0.3s ease;
    }

    .more-work-item:hover img {
        transform: scale(1.05);
    }

    .back-button {
        position: absolute;
        top: 80px;
        left: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: "Space Grotesk", sans-serif;
        font-size: 16px;
        font-weight: 500;
        color: #000;
        text-decoration: none;
        background: transparent;
        padding: 10px 16px;
        border-radius: 24px;
        border: none;
        transition: all 0.3s ease;
        z-index: 100;
    }

    .back-button:hover {
        opacity: 0.7;
    }

    @media (min-width: 768px) {
        .project-page {
            padding: 80px 40px 60px;
        }

        .design-grid {
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        .design-overview-section {
            margin: 0 -40px;
        }

        .back-button {
            left: 30px;
        }
    }
</style>
